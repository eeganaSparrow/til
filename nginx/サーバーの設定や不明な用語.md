# サーバーの設定や不明な用語

## nginxでどんなことを学ぶのか
* nginxの学習が思うように進まないのは出力される結果が地味で、設定したことを目に見えて確認することが難しいからだと思う。
* だから、学習の方針としては、以下を知ることをメインにしたい。
    1. サーバーではどんな設定が必要なのか、なぜ必要なのか
    2. サーバー関連でどんな用語が使われているか
* この方針で進めることで、「サーバーをいじるとは？」が理解できたらいいなあと思う。

## 1-1. サーバーではどんな設定をするのか
1. 基本的な設定
    * サーバーのホスト名とポート
    * リクエストで返すファイルパス
    * ログの出力先
        * access_log
        * error_log
        * ログのフォーマット
    * PIDファイルの出力先
2. プロセスに関する設定
    * ワーカプロセスの実行ユーザ
    * ワーカのプロセス数
    * ワーカが処理するプロセス数
3. パフォーマンスに関する設定
    * タイムアウト
    * ファイル送信方法
        * sendfile()を使用するかどうか
        * パケット数の最小化
    * キャッシュ
 
## 1-2. 静的なWebサイトの設定 
1. ページの遷移先
    * 配信ファイルの指定
    * エラーページの指定
2. アクセス制限
    * IPアドレス
    * Basic認証
    * リクエスト量の制限
        * 利用場面
            * Dos攻撃対策
3. ファイルパスの書き換え
    * エラーページの遷移
    * リダイレクト
    * 正規表現による書き換え
    * 利用場面
        * 特定のURIはエラーページにしたいとき
        * ページを変更したので、古いURIはリダイレクトしたいとき
4. gzip圧縮転送
    * 動的な圧縮
    * 静的な圧縮
    * 利用場面
        * ファイル転送を高速にしたいとき

## 1-3. HTTPSサーバの設定
0. HTTPS通信が必要な理由
    * 通信経路上での不正が簡単にできる環境だから、Webサイト全体をセキュアな状態にしておく必要がある。
    * HTTPSはサーバ証明書がいるが、勉強では自己証明書を使うと練習できるらしい。
1. 安全性のための設定
    * TLSの有効化
        * サーバ証明書
        * 秘密鍵
    * OpenSSLのバージョン確認
    * SSLv3の無効化
    * 暗号化スイート
        * Mozilla Wikiを確認
        * サーバの暗号化スイートを優先させる
    * DHパラメータファイル
    * SHA-2サーバ証明書の利用
2. 通信速度のための設定
    * HTTP/2、SPDY
    * TLSセッション再開
        * セッションキャッシュ
        * セッションチケット
    * OCSPステープリング
    * バッファサイズの最適化
3. 複数ドメイン運用時の設定
    * SNIの利用
    * ワイルドカード証明書
    * SANオプション

## 1-4. Webアプリケーションサーバの設定
0. リバースプロキシ
    * Webアプリケーションサーバでの役割は、リバースプロキシとしての利用
    * フロントとしての役割
        * ロードバランス
        * コンテンツキャッシュ
        * HTTPS終端処理
    * アプリケーションサーバ内での役割
        * １−２の機能を実現すること
        * リクエストのロギング
        * リクエストとレスポンスのバッファリング
        * アプリケーション側でも設定できるが、nginxで設定することで、アプリ内のバグやメンテナンスコストを減らすことができる
1. リバースプロキシの設定
    * プロキシ先の設定
    * リクエストボディに関する設定
        * 最大サイズ
        * バッファリング
        * 一時ファイルの出力先
    * レスポンスに関する設定
        * バッファリング
        * 一時ファイルの出力先
        * 一時ファイルの最大サイズ
    * タイムアウト
3. PHP
    * PHP-FRMの設定
    * nginxの設定
4. 
5. 
* 
* 
* 
* 
* 

## 2. どんな用語が使われているのか
* リバースプロキシ
    * Webサーバの中継として配置することで、セキュリティ、パフォーマンス、信頼性を向上させるもの
    * 外部Webサーバとの通信を監視するようなもの
* HTTPS終端処理
    * HTTPSからHTTPに復号する処理のこと
* イベント駆動
    * 通常のプログラムは上から順に実行される
    * それに対し、イベントに応じた処理が実行されるというのがイベント駆動
    * その際に以下を利用する
    * システムコール
        * inotify、sigaction
    * ライブラリ
        * libevent、libuv
* ディスクリプタ
    * プログラムが利用するファイルやソケットのための識別子
    * ファイルを特定するための目印のこと
    * ディスクリプタをやり取りすることで、クライアントとの通信が可能になる
* コンテキストスイッチ
    * 動作対象を切り替えること
    * 複数のユーザーを同時処理する場合にオーバーヘッドが大きくなる（C10K問題）
* PID
    * プロセスID
* サードパーティモジュール
    * 公式にはサポートされていない第三者機関が作ったモジュール
    * nginxはこれが豊富で様々な機能を追加できる
* MIME
    * 音声や画像も送れるようにする電子メールの拡張機能
* Basic認証
    * Webサイトの簡易認証
* HTTPS関連
    * TLS
    * サーバ証明書
    * 秘密鍵
    * OpenSSL
        * TLSを実現するライブラリ
    * SSLv3
        * TLS以前のプロトコルで、無効にすることが推奨されている
    * 暗号化スイート
        * 暗号化に必要なプロトコルのセット
        * 鍵認証、メッセージ認証符号、鍵交換、共通鍵暗号化などがある
    * DHパラメータファイル
    * SHA-2サーバ証明書
    * HTTP/2
    * SPDY
    * PFS
    * OCSP
    * SNIの利用
        * ホストが複数ある場合に、クライアント側でホスト名を付加してリクエストが送られる仕組み
    * ワイルドカード証明書
        * 任意のサブドメインで複数のサーバ証明書を利用できる仕組み
    * SANオプション
        * ドメインに別名を指定して、１つのサーバ証明書に複数のドメインを登録できる仕組み
* バッファリング
* PHP-FRM
* FastCGIプロトコル